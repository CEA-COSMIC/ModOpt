language: python
dist: bionic
sudo: required

jobs:
  include:
    - python: 3.5
    - python: 3.6
    - python: 3.7
    - python: 3.8
    - stage: deploy
      install:
        - pip install numpy future scipy astropy progressbar2 sphinx sphinx-rtd-theme sphinxcontrib-bibtex numpydoc travis-sphinx coveralls
      script:
        - sphinx-apidoc -feo docs/source modopt
        - travis-sphinx -v -o docs/build build -n -s docs/source
      after_success:
        - coveralls
        - travis-sphinx -o docs/build deploy
      # deploy:
      #   provider: pages
      #   skip_cleanup: true
      #   local_dir: docs/html
      #   github_token: $GH_REPO_TOKEN
      #   on:
      #     branch: master


# GitHub branch
branches:
  only:
    - master

# update pre-installed packages
before_install:
  - pip list --outdated --format=freeze | grep -v '^\-e' | cut -d = -f 1  | xargs -n1 pip install -U

# install package and dependencies
install:
  - pip install coverage nose pytest pytest-cov
  - pip install scikit-learn
  - pip install astropy scikit-image

# run unit tests
script:
  - python setup.py test

# notification settings
notification:
  email: false
